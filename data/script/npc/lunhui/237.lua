--人生转轮
NpcMenuInfo237 = {
	talk = "<p><n>    每次前进，都需消耗“生命的时钟”。</n></p>",
	button = {
		--开始事件
		{"生命的时钟(2)","NpcMenuInfo237:DealMenu1($1," .. 1 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 1 .. ")",VALUE_OK},
		{"勇敢的心（路人）(2)","NpcMenuInfo237:DealMenu2($1," .. 2 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 2 .. ")",VALUE_OK},
		{"真理之眼（学徒）(2)","NpcMenuInfo237:DealMenu3($1," .. 3 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 3 .. ")",VALUE_OK},
		{"勤劳的故事（农夫）(2)","NpcMenuInfo237:DealMenu4($1," .. 4 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 4 .. ")",VALUE_OK},
		{"真理之眼（教师）(2)","NpcMenuInfo237:DealMenu5($1," .. 5 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 5 .. ")",VALUE_OK},
		{"勤劳的故事（农学家）(2)","NpcMenuInfo237:DealMenu6($1," .. 6 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 6 .. ")",VALUE_OK},
		{"命运之手（白银）(2)","NpcMenuInfo237:DealMenu7($1," .. 7 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 7 .. ")",VALUE_OK},
		{"命运之手（黄金）(2)","NpcMenuInfo237:DealMenu8($1," .. 8 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 8 .. ")",VALUE_OK},
		{"女神之吻（双倍）(2)","NpcMenuInfo237:DealMenu9($1," .. 9 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 9 .. ")",VALUE_OK},
		{"命运之手（青铜）(2)","NpcMenuInfo237:DealMenu10($1," .. 10 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 10 .. ")",VALUE_OK},
		{"勇敢的心（路人）(2)","NpcMenuInfo237:DealMenu11($1," .. 11 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 11 .. ")",VALUE_OK},
		{"勇敢的心（勇士）(2)","NpcMenuInfo237:DealMenu12($1," .. 12 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 12 .. ")",VALUE_OK},
		{"勇敢的心（骑士）(2)","NpcMenuInfo237:DealMenu13($1," .. 13 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 13 .. ")",VALUE_OK},
		{"勇敢的心（典范）(2)","NpcMenuInfo237:DealMenu14($1," .. 14 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 14 .. ")",VALUE_OK},
		{"勇敢的心（英雄）(2)","NpcMenuInfo237:DealMenu15($1," .. 15 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 15 .. ")",VALUE_OK},
		{"勇敢的心（猛将）(2)","NpcMenuInfo237:DealMenu16($1," .. 16 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 16 .. ")",VALUE_OK},
		{"勇敢的心（王者）(2)","NpcMenuInfo237:DealMenu17($1," .. 17 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 17 .. ")",VALUE_OK},
		{"真理之眼（教授）(2)","NpcMenuInfo237:DealMenu18($1," .. 18 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 18 .. ")",VALUE_OK},
		{"命运之手（黑铁）(2)","NpcMenuInfo237:DealMenu19($1," .. 19 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 19 .. ")",VALUE_OK},
		{"勤劳的故事（大科学家）(2)","NpcMenuInfo237:DealMenu20($1," .. 20 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 20 .. ")",VALUE_OK},
		{"开始事件21(2)","NpcMenuInfo237:DealMenu0($1," .. 21 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 21 .. ")",VALUE_OK},
		{"开始事件22(2)","NpcMenuInfo237:DealMenu0($1," .. 22 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 22 .. ")",VALUE_OK},
		{"开始事件23(2)","NpcMenuInfo237:DealMenu0($1," .. 23 .. ")","NpcMenuInfo237:ShowMenu0($1," .. 23 .. ")",VALUE_OK},

		--完成事件
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish1($1," .. 1 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 1 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish2($1," .. 2 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 2 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish3($1," .. 3 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 3 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish4($1," .. 4 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 4 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish5($1," .. 5 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 5 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish6($1," .. 6 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 6 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish7($1," .. 7 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 7 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish8($1," .. 8 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 8 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish9($1," .. 9 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 9 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish10($1," .. 10 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 10 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish11($1," .. 11 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 11 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish12($1," .. 12 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 12 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish13($1," .. 13 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 13 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish14($1," .. 14 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 14 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish15($1," .. 15 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 15 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish16($1," .. 16 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 16 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish17($1," .. 17 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 17 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish18($1," .. 18 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 18 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish19($1," .. 19 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 19 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish20($1," .. 20 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 20 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish0($1," .. 21 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 21 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish0($1," .. 22 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 22 .. ")",VALUE_OK},
		{"故事结束（领取奖励）(2)","NpcMenuInfo237:DealFinish0($1," .. 23 .. ")","NpcMenuInfo237:ShowFinish0($1," .. 23 .. ")",VALUE_OK},

		--随机计算
		{"随机计算下一层(2)","NpcMenuInfo237:DealRandom0($1)","NpcMenuInfo237:ShowRandom0($1)",VALUE_OK},
		--玩家本次副本已经走过3圈，可以领取剩下所有的故事书奖励
		{"已过3圈，免费领取所有剩余奖励(2)","NpcMenuInfo237:DealGetAllLeftGift($1)","NpcMenuInfo237:ShowGetAllLeftGift($1)",VALUE_OK},

		--进入下一层
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 1 .. ")","NpcMenuInfo237:ShowNext0($1," .. 1 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 2 .. ")","NpcMenuInfo237:ShowNext0($1," .. 2 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 3 .. ")","NpcMenuInfo237:ShowNext0($1," .. 3 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 4 .. ")","NpcMenuInfo237:ShowNext0($1," .. 4 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 5 .. ")","NpcMenuInfo237:ShowNext0($1," .. 5 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 6 .. ")","NpcMenuInfo237:ShowNext0($1," .. 6 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 7 .. ")","NpcMenuInfo237:ShowNext0($1," .. 7 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 8 .. ")","NpcMenuInfo237:ShowNext0($1," .. 8 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 9 .. ")","NpcMenuInfo237:ShowNext0($1," .. 9 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 10 .. ")","NpcMenuInfo237:ShowNext0($1," .. 10 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 11 .. ")","NpcMenuInfo237:ShowNext0($1," .. 11 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 12 .. ")","NpcMenuInfo237:ShowNext0($1," .. 12 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 13 .. ")","NpcMenuInfo237:ShowNext0($1," .. 13 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 14 .. ")","NpcMenuInfo237:ShowNext0($1," .. 14 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 15 .. ")","NpcMenuInfo237:ShowNext0($1," .. 15 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 16 .. ")","NpcMenuInfo237:ShowNext0($1," .. 16 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 17 .. ")","NpcMenuInfo237:ShowNext0($1," .. 17 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 18 .. ")","NpcMenuInfo237:ShowNext0($1," .. 18 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 19 .. ")","NpcMenuInfo237:ShowNext0($1," .. 19 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 20 .. ")","NpcMenuInfo237:ShowNext0($1," .. 20 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 21 .. ")","NpcMenuInfo237:ShowNext0($1," .. 21 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 22 .. ")","NpcMenuInfo237:ShowNext0($1," .. 22 .. ")",VALUE_OK},
		{"时光流逝（下个故事）(2)","NpcMenuInfo237:DealNext0($1," .. 23 .. ")","NpcMenuInfo237:ShowNext0($1," .. 23 .. ")",VALUE_OK},

		--低价购买10个生命时钟
		--{"购买10个生命时钟（200银币/1天1次）(2)","GetPayTimeClock($1)","NpcMenuInfo237:ShowLeave0($1)"},

		--购买生命时钟
		{"购买5个生命时钟（500银币）(2)","GetTimeClock($1)","NpcMenuInfo237:ShowLeave0($1)"},

		--离开副本
		{"离开副本(3)","NpcMenuInfo237:DealLeave0($1)","NpcMenuInfo237:ShowLeave0($1)",VALUE_OK},
	},
}

--检查当前副本是否为人生转轮副本
function CheckCopyLunHui(uid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	if customid ~= 1004
	then
		return VALUE_FAIL
	end
	return VALUE_OK
end

--胜负事件额外经验奖励
function fateDiceExp(uid)
	if uid == 0 or uid == nil then
		return
	end
	local level = s_getValue(SCENE_ENTRY_PLAYER,uid,VALUE_TYPE_LEVEL)
	return 10*(50+0.1*level^2.2)
end

--事件0
function NpcMenuInfo237:ShowMenu0(uid, eventid)
	if CheckCopyLunHui(uid) == VALUE_FAIL then return VALUE_FAIL end
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local curZone = s_getSceneVar(sid, 4, 1)
	if s_getSceneVar(sid, 100, curZone) == 1 then return VALUE_FAIL end
	if s_getSceneVar(sid, 4, 4) ~= 0 then return VALUE_FAIL end
	if s_getSceneVar(sid, 1, eventid) == 1 then return VALUE_OK end
	return VALUE_FAIL
end

function NpcMenuInfo237:DealMenu0(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)

	if eventid == 1 then
		s_setSceneVar(sid, 4, 4, 1)
	elseif eventid == 2 then
	end

	s_setSceneVar(sid, 4, 4, 1)
	s_copyInfo(sid, "这层开启，请去完成事件！")
end

function NpcMenuInfo237:ShowFinish0(uid, eventid)
	if CheckCopyLunHui(uid) == VALUE_FAIL then return VALUE_FAIL end
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 4) ~= 1 and s_getSceneVar(sid, 4, 4) ~= 2 then return VALUE_FAIL end
	if s_getSceneVar(sid, 1, eventid) == 1 then
		return VALUE_OK
	end
end

function NpcMenuInfo237:DealFinish0(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 4) ~= 2 then
		s_messageBox(uid,"事件还没有完成！")
		return
	end

	--获取奖励
	if eventid == 1 then
	elseif eventid == 2 then
	end

	s_setSceneVar(sid, 4, 4, 3)
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
end

--事件1（直接获得10个生命的时钟道具）
function NpcMenuInfo237:DealMenu1(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	s_setSceneVar(sid, 4, 4, 1)
end

function NpcMenuInfo237:DealFinish1(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	--获取奖励
	s_addItem(uid,28000,0,10,0,"1-1","人生转轮事件1")
	s_addItem(uid,28001,0,1,0,"1-1,3-604800","人生转轮事件1")
	s_setVar(uid,116,120,s_getVar(uid,116,120) + 1)
	s_setSceneVar(sid, 4, 4, 3)
	s_copySmile(uid, 60, customid, sid, {7})
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
	ShowNpcMenuByTable(uid,self)
end

--事件3（召唤2种npc，击败后均可完成事件，只有击败特定NPC可获得奖励）
function NpcMenuInfo237:DealMenu3(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local posx = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSX)
	local posy = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSY)
	s_setSceneVar(sid, 6, 1, 0)
	s_setSceneVar(sid, 6, 2, 0)
	s_copySummonNpcToKill(uid, 60, customid, sid, {24001,1,posx+3,posy+3,103,0,6,1,1})
	s_copySummonNpcToKill(uid, 60, customid, sid, {24000,1,posx-3,posy+3,103,0,6,2,1})
	s_setSceneVar(sid, 4, 4, 1)
end

function NpcMenuInfo237:DealFinish3(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 4) ~= 2 then
		s_messageBox(uid,"事件还没有完成！")
		return
	end
	--获取奖励
	if eventid == 3 then
		if s_getSceneVar(sid, 6, 1) == 1 then
			s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		end
		s_addItem(uid,28001,0,25,0,"1-1,3-604800","事件3奖励")
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 25)
	end
	s_setSceneVar(sid, 6, 1, 0)
	s_setSceneVar(sid, 6, 2, 0)
	s_setSceneVar(sid, 4, 4, 3)
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
	ShowNpcMenuByTable(uid,self)
end

--事件4(召唤可采集NPC，需求道具才可完成事件)
function NpcMenuInfo237:DealMenu4(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local posx = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSX)
	local posy = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSY)
	s_setSceneVar(sid, 7, 1, 0)
	s_copySummonNpc(uid, 60, customid, sid,{60188, 3, posx+5, posy+5, 100, 0})
	s_setSceneVar(sid, 4, 4, 1)
end

function NpcMenuInfo237:DealFinish4(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_checkItem(uid,31550,3) ~= VALUE_OK then
		s_messageBox(uid,"道具数量不足3个，请继续采集")
		s_sysInfo(uid,"道具数量不足3个")
		return VALUE_FAIL
	end
	if s_deleteItemByBaseID(uid,31550,3,"事件4扣除")~= VALUE_OK then
		s_sysInfo(uid,"扣除道具失败")
		return VALUE_FAIL
	end
	s_setSceneVar(sid, 7, 1, 3)
	s_setSceneVar(sid, 4, 4, 2)
	--获取奖励
	if eventid == 4 then
		if s_getSceneVar(sid, 7, 1) == 3 then
			s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		end
		s_addItem(uid,28001,0,2,0,"1-1,3-604800","事件4奖励")
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 2)
	end
	s_copySmile(uid, 60, customid, sid, {19})
	s_setSceneVar(sid, 7, 1, 0)
	s_setSceneVar(sid, 4, 4, 3)
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
	s_copyDeleteItemByBaseID(uid, 60, customid, sid, {31550,0,"离开场景回收",0})
	ShowNpcMenuByTable(uid,self)
end

--事件5（召唤3个npc，击败后均可完成事件，只有击败特定NPC可获得奖励）
function NpcMenuInfo237:DealMenu5(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local posx = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSX)
	local posy = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSY)
	s_setSceneVar(sid, 8, 1, 0)
	s_setSceneVar(sid, 8, 2, 0)
	s_copySummonNpcToKill(uid, 60, customid, sid, {24008,1,posx+3,posy+3,103,0,8,1,1})
	s_copySummonNpcToKill(uid, 60, customid, sid, {24009,2,posx-3,posy-3,103,0,8,2,1})
	s_setSceneVar(sid, 4, 4, 1)
end

function NpcMenuInfo237:DealFinish5(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 4) ~= 2 then
		s_messageBox(uid,"事件还没有完成！")
		return
	end
	--获取奖励
	if eventid == 5 then
		if s_getSceneVar(sid, 8, 1) == 1 then
			s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		end
		s_addItem(uid,28001,0,1,0,"1-1,3-604800","事件5奖励")
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 1)
	end
	s_setSceneVar(sid, 8, 1, 0)
	s_setSceneVar(sid, 8, 2, 0)
	s_setSceneVar(sid, 4, 4, 3)
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
	ShowNpcMenuByTable(uid,self)
end


--事件7（翻牌赢取奖励 胜利奖励5本，60%几率）
function NpcMenuInfo237:DealMenu7(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_checkItem(uid,28001,1) ~= VALUE_OK then
		s_sysInfo(uid,"需要消耗1本“故事书”才可翻牌，翻牌胜利可获得更多的故事书，如失败，当前扣除故事书不返还。")
		return VALUE_FAIL
	end
	if s_deleteItemByBaseID(uid,28001,1,"幸运的翻牌") == VALUE_OK then
		local gc = GuessCard:Start(uid,"","<p><n>  敢和精通翻牌的我比大小吗？</n><newline/><n>  赢：获得10本“故事书”道具</n><newline/><n>  输：扣了的书可不还你！</n></p>",2)
		local call = Call:New(uid,nil,CopyEventGuessBox,{})
		gc:registerOverEvent(call)
	end
	s_setSceneVar(sid, 4, 4, 3)
end

function CopyEventGuessBox(uid,param,param_ext)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	if param_ext ~= nil and param_ext[1] ~= nil and param_ext[1] > 0 then --赢
		s_addItem(uid,28001,0,15,0,"1-1,3-604800","事件7奖励",0)
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 15)
		s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		s_copySmile(uid, 60, customid, sid, {9})
		s_setSceneVar(sid, 10, 1, 0)
	else--if ret > 0 then --输
		s_addItem(uid,28001,0,15,0,"1-1,3-604800","事件7奖励",0)
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 15)
		s_copySmile(uid, 60, customid, sid, {12})
		s_setSceneVar(sid, 10, 1, 0)
	end
end

--事件11（召唤1种npc，击败后均可完成事件）
function NpcMenuInfo237:DealMenu11(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local posx = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSX)
	local posy = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSY)
	s_setSceneVar(sid, 14, 1, 0)
	s_copySummonNpcToKill(uid, 60, customid, sid, {24002,5,posx+3,posy+3,103,0,14,1,5})
	s_setSceneVar(sid, 4, 4, 1)
end

function NpcMenuInfo237:DealFinish11(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 4) ~= 2 then
		s_messageBox(uid,"事件还没有完成！")
		return
	end
	--获取奖励
	if eventid == 11 then
		if s_getSceneVar(sid, 14, 1) == 5 then
			s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		end
		s_addItem(uid,28001,0,1,0,"1-1,3-604800","事件11奖励")
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 1)
	end
	s_setSceneVar(sid, 14, 1, 0)
	s_setSceneVar(sid, 4, 4, 3)
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
	ShowNpcMenuByTable(uid,self)
end

--事件12（召唤1种npc，击败后均可完成事件,需击败8个）
function NpcMenuInfo237:DealMenu12(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local posx = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSX)
	local posy = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSY)
	s_setSceneVar(sid, 15, 1, 0)
	s_copySummonNpcToKill(uid, 60, customid, sid, {24003,8,posx+3,posy+3,103,0,15,1,8})
	s_setSceneVar(sid, 4, 4, 1)
	s_copySmile(uid, 60, customid, sid, {23})
end

function NpcMenuInfo237:DealFinish12(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 4) ~= 2 then
		s_messageBox(uid,"事件还没有完成！")
		return
	end
	--获取奖励
	if eventid == 12 then
		if s_getSceneVar(sid, 15, 1) == 8 then
			s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		end
		s_addItem(uid,28001,0,2,0,"1-1,3-604800","事件12奖励")
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 2)
	end
	s_setSceneVar(sid, 15, 1, 0)
	s_setSceneVar(sid, 4, 4, 3)
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
	ShowNpcMenuByTable(uid,self)
end

--事件18（召唤3种npc，击败后均可完成事件，只有击败特定NPC可获得奖励）
function NpcMenuInfo237:DealMenu18(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local posx = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSX)
	local posy = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSY)
	s_setSceneVar(sid, 21, 1, 0)
	s_setSceneVar(sid, 21, 2, 0)
	s_copySummonNpcToKill(uid, 60, customid, sid, {24010,1,posx+3,posy+3,103,0,21,1,1})
	s_copySummonNpcToKill(uid, 60, customid, sid, {24011,1,posx+3,posy+3,103,0,21,2,1})
	s_copySummonNpcToKill(uid, 60, customid, sid, {24011,1,posx+3,posy+3,103,0,21,2,1})
	s_setSceneVar(sid, 4, 4, 1)
end

function NpcMenuInfo237:DealFinish18(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 4) ~= 2 then
		s_messageBox(uid,"事件还没有完成！")
		return
	end
	--获取奖励
	if eventid == 18 then
		if s_getSceneVar(sid, 21, 1) == 1 then
			s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		end
		s_addItem(uid,28001,0,5,0,"1-1,3-604800","事件18奖励")
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 5)
	end
	s_setSceneVar(sid, 21, 1, 0)
	s_setSceneVar(sid, 21, 2, 0)
	s_setSceneVar(sid, 4, 4, 3)
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
	ShowNpcMenuByTable(uid,self)
end

--事件19（翻牌不扣除故事书，赢取奖励 胜利奖励4本，30%几率）
function NpcMenuInfo237:DealMenu19(uid, eventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local gc = GuessCard:Start(uid,"","<p><n>  敢和精通翻牌的我比大小吗？</n><newline/><n>  赢：获得8本“故事书”道具</n><newline/><n>  输：不损失“故事书”！</n></p>",2)
	local call = Call:New(uid,nil,CopyEventGuessBox4,{})
	gc:registerOverEvent(call)
	s_setSceneVar(sid, 4, 4, 3)
end

function CopyEventGuessBox4(uid,param,param_ext)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	if param_ext ~= nil and param_ext[1] ~= nil and param_ext[1] > 0 then --赢
		s_addItem(uid,28001,0,15,0,"1-1,3-604800","事件19奖励",0)
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 15)
		s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		s_copySmile(uid, 60, customid, sid, {9})
		s_setSceneVar(sid, 22, 1, 0)
	else--if ret > 0 then --输
		s_addItem(uid,28001,0,15,0,"1-1,3-604800","事件19奖励",0)
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 15)
		s_copySmile(uid, 60, customid, sid, {12})
		s_setSceneVar(sid, 22, 1, 0)
	end
end

--事件20（召唤采集NPC）
function NpcMenuInfo237:DealMenu20(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local posx = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSX)
	local posy = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_POSY)
	s_setSceneVar(sid, 23, 1, 0)
	s_copySummonNpc(uid, 60, customid, sid,{60190, 3, posx+5, posy+5, 100, 0})
	s_setSceneVar(sid, 4, 4, 1)
end

function NpcMenuInfo237:DealFinish20(uid, eventid)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_checkItem(uid,31552,3) ~= VALUE_OK then
		s_messageBox(uid,"小麦数量不足3个，请继续采集")
		s_sysInfo(uid,"小麦数量不足3个")
		return VALUE_FAIL
	end
	if s_deleteItemByBaseID(uid,31552,3,"事件20扣除")~= VALUE_OK then
		s_sysInfo(uid,"扣除道具失败")
		return VALUE_FAIL
	end
	s_setSceneVar(sid, 23, 1, 3)
	s_setSceneVar(sid, 4, 4, 2)
	--获取奖励
	if eventid == 20 then
		if s_getSceneVar(sid, 23, 1) == 3 then
			s_refreshExp(uid,fateDiceExp(uid),ExpType_OptionalTask,0)
		end
		s_addItem(uid,28001,0,5,0,"1-1,3-604800","事件20奖励")
		s_setVar(uid,116,120,s_getVar(uid,116,120) + 5)
	end
	s_copySmile(uid, 60, customid, sid, {19})
	s_setSceneVar(sid, 23, 1, 0)
	s_setSceneVar(sid, 4, 4, 3)
	s_copyInfo(sid, "这层完成，奖励发放！请去随机下一层！")
	ShowNpcMenuByTable(uid,self)
end

--随机进入房间
function NpcMenuInfo237:ShowRandom0(uid)
	if CheckCopyLunHui(uid) == VALUE_FAIL then return VALUE_FAIL end
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local zoneid = s_getSceneVar(sid, 4, 1)
	local eventid = s_getSceneVar(sid, 2, zoneid)
	--3圈过后不能再随机下一层
	if s_getSceneVar(sid, 4, 3) >= CopySceneInfo_1004.maxzone * 3 then return VALUE_FAIL end
	--已经随机过下次层数
	if s_getSceneVar(sid, 4, 2) > 0 then return VALUE_FAIL end
	if s_getSceneVar(sid, 100, zoneid) == 1 then
		return VALUE_OK
	end
	--当前事件未领取奖励
	if s_getSceneVar(sid, 4, 4) ~= 3 then return VALUE_FAIL end
	return VALUE_OK
end

function NpcMenuInfo237:DealRandom0(uid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_checkItem(uid,28000,1) ~= VALUE_OK then
		s_messageBox(uid,"生命的时钟不够，无法进入下一层")
		s_sysInfo(uid,"<p><n>每需消耗1个生命时钟道具才可进入下一层。</n><store id='1' tabid='0' text='立即购买' treeid='1'/></p>")
		return VALUE_FAIL
	end
	s_deleteItemByBaseID(uid,28000,1,"人生转轮")
	s_sysInfo(uid,"<p><n>消耗1个生命时钟，你感觉时光在流逝，具备了前进的力量。</n></p>")
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	local zoneid = s_getSceneVar(sid, 4, 1)
	local rand = math.random(1, 3)
	local nextzoneid = zoneid + rand
	--记录总层数
	s_setSceneVar(sid, 4, 3, s_getSceneVar(sid, 4, 3) + rand)
	local customid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_CUSTOMCOPYID)
	if customid == 1004 then
		if nextzoneid > CopySceneInfo_1004.maxzone then
			nextzoneid = nextzoneid - CopySceneInfo_1004.maxzone
		end
	end
	s_copyInfo(sid, "生命时钟的指针开始转动，您向前" .. rand .. "步, 来到了" .. nextzoneid .."号岛")
	s_setSceneVar(sid, 4, 2, nextzoneid)
	s_copyAddBuff(uid, 60, customid, sid, {5018, 0, 5, 0})
	ShowNpcMenuByTable(uid,self)
end

function NpcMenuInfo237:ShowGetAllLeftGift(uid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 5) == 1 then return VALUE_FAIL end
	if s_getSceneVar(sid, 4, 3) >= CopySceneInfo_1004.maxzone * 3 then
		return VALUE_OK
	end
end

function NpcMenuInfo237:DealGetAllLeftGift(uid)
	if uid == 0 or uid == nil then
		return
	end
	if CopySceneInfo_1004.maxGiftNum > s_getVar(uid,116,120) then
		local leftGiftNum = CopySceneInfo_1004.maxGiftNum - s_getVar(uid,116,120)
		s_addItem(uid,28001,0,leftGiftNum,0,"1-1","人生转轮3圈剩余奖励")
		local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
		s_setSceneVar(sid, 4, 5, 1)
	end
end

--下个故事
function NpcMenuInfo237:ShowNext0(uid, cureventid)
	if CheckCopyLunHui(uid) == VALUE_FAIL then return VALUE_FAIL end
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	if s_getSceneVar(sid, 4, 2) == 0 then return VALUE_FAIL end
	--3圈过后不能再进入下一层
	if s_getSceneVar(sid, 4, 3) >= CopySceneInfo_1004.maxzone * 3 then return VALUE_FAIL end
	if s_getSceneVar(sid, 1, cureventid) == 1 then
		return VALUE_OK
	end
	return VALUE_FAIL
end

function NpcMenuInfo237:DealNext0(uid, cureventid)
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	s_setSceneVar(sid, 1, cureventid, 0)
	local curZone = s_getSceneVar(sid, 4, 1)
	s_setSceneVar(sid, 100, curZone, 1)
	--各岛的奖励领取状态列表，发给客户端用于更新大地图图标
	local gift_state_list = {}
	for zoneid = 1, CopySceneInfo_1004.maxzone, 1 do
		table.insert(gift_state_list, zoneid)
		local isHaveGift = 0
		if s_getSceneVar(sid, 100, zoneid) == 0 then
			isHaveGift = event_quality[s_getSceneVar(sid, 2, zoneid)]
		end
		table.insert(gift_state_list, isHaveGift)
	end
	s_sendCopyVar(CopySceneType_Custom_Single, sid, uid, CopySceneInfo_1004.maxzone, gift_state_list)

	CopySceneInfo_1004:ClearNpc(sid)
	local nextzoneid = s_getSceneVar(sid, 4, 2)
	s_setSceneVar(sid, 4, 2, 0)
	CopySceneInfo_1004:InitZone(sid, uid, nextzoneid)
end

--离开副本
function NpcMenuInfo237:ShowLeave0(uid)
	if CheckCopyLunHui(uid) == VALUE_FAIL then return VALUE_FAIL end
	return VALUE_OK
end

function NpcMenuInfo237:DealLeave0(uid)
	local msg = "您确定要离开副本吗？"
	local buttons = "确定|3|Enter|取消|4|Esc"
	local call = "NpcMenuInfo237:DealLeaveCopy($1,$2,$3)"
	s_registerMsgBox(uid,call,buttons,msg,300)
	return VALUE_OK
end

function NpcMenuInfo237:DealLeaveCopy(uid,result,baseid)
	if result ~= Button_Yes then
		return
	end
	local sid = s_getValue(SCENE_ENTRY_PLAYER, uid, VALUE_TYPE_SCENE_ID)
	s_clearCopy(sid)
	s_setSceneVar(sid, 24, 1, 0)
end

--购买生命时钟
function GetTimeClock(uid)
	local msg = "你确定要购买5个生命的时钟？"
	local buttons = "确定|3|Enter|取消|4|Esc"
	local call = "DealGetTimeClock2($1,$2,$3)"
	s_registerMsgBox(uid,call,buttons,msg,300)
	return VALUE_OK
end

function DealGetTimeClock2(uid,result,baseid)
	if result ~= Button_Yes then
		return
	end
	if s_removeMoney(uid,MoneyType_Money,500,"购买5个生命的时钟") == VALUE_FAIL then
		s_sysInfo(uid,"您身上的金币不足500银币")
		return
	end
	s_addItem(uid,28000,3,5,0,"1-1","购买生命时钟")
end

--每天1次低价购买生命时钟
--[[
function GetPayTimeClock(uid)
if s_getVar(uid,116,59) ~= 0 then
s_sysInfo(uid,"您今天的优惠次数已消耗，明天将可继续购买。")
return VALUE_FAIL
end
local msg = "你确定要购买10个生命的时钟？"
local buttons = "确定|3|Enter|取消|4|Esc"
local call = "DealGetTimeClock($1,$2,$3)"
s_registerMsgBox(uid,call,buttons,msg,300)
return VALUE_OK
end

function DealGetTimeClock(uid,result,baseid)
if result ~= Button_Yes then
return
end
if s_removeMoney(uid,MoneyType_Money,1000,"购买10个生命的时钟") == VALUE_FAIL then
s_sysInfo(uid,"您身上的金币不足1000银币")
return
end
s_addItem(uid,28000,3,10,0,"1-1","生命时钟")
end
]]

--npc对话选项与237相同（对话内容在npc对话表中配置）
NpcMenuInfo238	= { button = NpcMenuInfo237.button,}
NpcMenuInfo239	= { button = NpcMenuInfo237.button,}
NpcMenuInfo240 	= { button = NpcMenuInfo237.button,}
NpcMenuInfo241	= { button = NpcMenuInfo237.button,}
NpcMenuInfo242	= { button = NpcMenuInfo237.button,}
NpcMenuInfo243	= { button = NpcMenuInfo237.button,}
NpcMenuInfo244	= { button = NpcMenuInfo237.button,}
NpcMenuInfo245	= { button = NpcMenuInfo237.button,}
NpcMenuInfo246	= { button = NpcMenuInfo237.button,}
NpcMenuInfo247	= { button = NpcMenuInfo237.button,}
NpcMenuInfo248	= { button = NpcMenuInfo237.button,}
NpcMenuInfo249	= { button = NpcMenuInfo237.button,}
NpcMenuInfo250	= { button = NpcMenuInfo237.button,}
NpcMenuInfo251	= { button = NpcMenuInfo237.button,}
NpcMenuInfo252	= { button = NpcMenuInfo237.button,}
NpcMenuInfo253	= { button = NpcMenuInfo237.button,}
NpcMenuInfo254	= { button = NpcMenuInfo237.button,}
NpcMenuInfo255	= { button = NpcMenuInfo237.button,}
NpcMenuInfo256	= { button = NpcMenuInfo237.button,}
NpcMenuInfo257	= { button = NpcMenuInfo237.button,}
NpcMenuInfo258	= { button = NpcMenuInfo237.button,}
NpcMenuInfo259	= { button = NpcMenuInfo237.button,}
NpcMenuInfo260	= { button = NpcMenuInfo237.button,}
NpcMenuInfo261	= { button = NpcMenuInfo237.button,}
